<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Staff Management</title>
    <link rel="icon" href="img/sweetbox_icon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="design.css" />
    <link rel="stylesheet" href="responsive.css" />
  </head>

  <body data-page="employees">
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <img src="img/sweetbox_logo.png" alt="Sweet Box" class="brand-logo" />
        </div>
        <nav class="nav">
          <a href="index.html" data-section="dashboard">Dashboard</a>
          <a href="attendance.html" data-section="attendance">Attendance</a>
          <a
            href="employees.html"
            data-section="employees"
            data-role="admin,manager"
            data-hide-when-denied="true"
            >Team</a
          >
          <a
            href="inventory.html"
            data-section="inventory"
            data-role="admin,inventory_manager,kitchen_staff"
            data-hide-when-denied="true"
            >Inventory</a
          >
          <a href="orders.html" data-section="orders">Orders</a>
          <a
            href="analytics.html"
            data-section="analytics"
            data-role="admin,manager"
            data-hide-when-denied="true"
            >Analytics</a
          >
          <a
            href="report.html"
            data-section="report"
            data-role="admin,inventory_manager"
            data-hide-when-denied="true"
            >Reports</a
          >
        </nav>
        <div class="user-session">
          <div class="user-session-info">
            <div class="user-session-row">
              <strong id="session-name" class="user-session-name">Guest</strong>
              <button
                id="edit-profile-btn"
                type="button"
                class="user-session-edit-btn"
                title="Edit Profile"
              >
                ✏️
              </button>
            </div>
            <small id="session-role" class="user-session-role"
              >Sign in required</small
            >
          </div>
          <button class="btn btn-outline" id="logout-btn" type="button">
            Sign out
          </button>
        </div>
      </aside>

      <main class="main-content">
        <header class="page-header">
          <div>
            <span class="pill">HR tools</span>
            <h1>Staff Management</h1>
          </div>
          <div class="actions">
            <button class="btn btn-secondary" id="refresh-data">Refresh</button>
          </div>
        </header>

        <!-- Live Metrics -->
        <section class="card live-metrics-card">
          <div class="live-metrics-grid">
            <div class="live-metric-item">
              <small>Total Staff</small>
              <div class="live-metric-value" id="quick-total-staff">0</div>
            </div>
            <div class="live-metric-item">
              <small>Active</small>
              <div class="live-metric-value active" id="active-today-count">
                0
              </div>
            </div>
            <div class="live-metric-item">
              <small>Inactive</small>
              <div class="live-metric-value inactive" id="inactive-count">
                0
              </div>
            </div>
            <div class="live-metric-item">
              <small>On Shift</small>
              <div class="live-metric-value on-shift" id="on-shift-count">
                0
              </div>
            </div>
            <div class="live-metric-item">
              <small>Off Shift</small>
              <div class="live-metric-value off-shift" id="off-shift-count">
                0
              </div>
            </div>
            <div class="live-metric-item">
              <small>Absent</small>
              <div class="live-metric-value absent" id="absent-count">0</div>
            </div>
            <div class="live-metric-item">
              <small>On Leave</small>
              <div class="live-metric-value on-leave" id="on-leave-count">
                0
              </div>
            </div>
          </div>
        </section>

        <!-- Team Snapshot - Compact Summary -->
        <section class="card section-mt-1-5">
          <div class="section-heading">
            <h2>Team Overview</h2>
            <span class="pill">Live</span>
          </div>

          <div style="display: flex; gap: 1.5rem; flex-wrap: wrap">
            <!-- Permission Distribution (80%) -->
            <div style="flex: 4; min-width: 300px">
              <strong
                style="display: block; margin-bottom: 0.75rem; color: #555"
                >Permission Distribution</strong
              >
              <div
                style="
                  display: flex;
                  gap: 0.5rem;
                  margin-bottom: 0.5rem;
                  height: 32px;
                  border-radius: 6px;
                  overflow: hidden;
                "
              >
                <div
                  id="permission-bar-admin"
                  style="
                    background: #f6c343;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: #333;
                    transition: all 0.3s;
                  "
                  title="Admin"
                ></div>
                <div
                  id="permission-bar-manager"
                  style="
                    background: #9c27b0;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    transition: all 0.3s;
                  "
                  title="Manager"
                ></div>
                <div
                  id="permission-bar-kitchen"
                  style="
                    background: #ff9800;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    transition: all 0.3s;
                  "
                  title="Kitchen Staff"
                ></div>
                <div
                  id="permission-bar-front"
                  style="
                    background: #2196f3;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    transition: all 0.3s;
                  "
                  title="Front Staff"
                ></div>
                <div
                  id="permission-bar-delivery"
                  style="
                    background: #4caf50;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: white;
                    transition: all 0.3s;
                  "
                  title="Delivery Staff"
                ></div>
              </div>
              <div
                style="
                  display: flex;
                  gap: 1.5rem;
                  flex-wrap: wrap;
                  margin-top: 0.75rem;
                  font-size: 0.875rem;
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span
                    style="
                      width: 12px;
                      height: 12px;
                      background: #f6c343;
                      border-radius: 2px;
                      display: inline-block;
                    "
                  ></span>
                  <span id="permission-legend-admin">0 Admin</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span
                    style="
                      width: 12px;
                      height: 12px;
                      background: #9c27b0;
                      border-radius: 2px;
                      display: inline-block;
                    "
                  ></span>
                  <span id="permission-legend-manager">0 Manager</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span
                    style="
                      width: 12px;
                      height: 12px;
                      background: #ff9800;
                      border-radius: 2px;
                      display: inline-block;
                    "
                  ></span>
                  <span id="permission-legend-kitchen">0 Kitchen</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span
                    style="
                      width: 12px;
                      height: 12px;
                      background: #2196f3;
                      border-radius: 2px;
                      display: inline-block;
                    "
                  ></span>
                  <span id="permission-legend-front">0 Front</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span
                    style="
                      width: 12px;
                      height: 12px;
                      background: #4caf50;
                      border-radius: 2px;
                      display: inline-block;
                    "
                  ></span>
                  <span id="permission-legend-delivery">0 Delivery</span>
                </div>
              </div>
            </div>

            <!-- Leave Approval (20%) -->
            <div style="flex: 1; min-width: 250px">
              <strong
                style="display: block; margin-bottom: 0.75rem; color: #555; text-align: center;"
                >Requests</strong
              >
              <div
                id="leave-approval-list"
                style="max-height: 300px; overflow-y: auto"
              >
                <p
                  style="
                    color: #888;
                    font-size: 0.875rem;
                    text-align: center;
                    padding: 1rem;
                  "
                >
                  No pending requests
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1rem;
              padding-top: 1rem;
              border-top: 1px solid #eee;
            "
          >
            <div>
              <small
                style="
                  color: #666;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.25rem;
                "
                >Active Rate</small
              >
              <strong
                style="font-size: 1.25rem; color: #4caf50"
                id="active-rate"
                >0%</strong
              >
            </div>
            <div>
              <small
                style="
                  color: #666;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.25rem;
                "
                >Newest Hire</small
              >
              <strong style="font-size: 1rem; color: #333" id="newest-hire"
                >--</strong
              >
            </div>
            <div>
              <small
                style="
                  color: #666;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.25rem;
                "
                >Average Tenure</small
              >
              <strong style="font-size: 1rem; color: #333" id="average-tenure"
                >--</strong
              >
            </div>
          </div>
        </section>

        <section class="table-wrapper" style="margin-top: 2rem">
          <div
            class="section-heading"
            style="margin-bottom: 1rem; align-items: center"
          >
            <div>
              <h2>Employee Roster</h2>
              <span class="pill">System of record</span>
            </div>
            <div
              style="
                display: flex;
                gap: 0.75rem;
                align-items: center;
                flex-wrap: nowrap;
              "
            >
              <input
                type="text"
                id="staff-search"
                placeholder="Search by name, email, or role..."
                style="
                  padding: 0.5rem 1rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  min-width: 250px;
                "
              />
              <select
                id="permission-filter"
                style="
                  padding: 0.5rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="">All Permissions</option>
                <option value="admin">Admin</option>
                <option value="kitchen_staff">Kitchen Staff</option>
                <option value="front_staff">Front Staff</option>
                <option value="delivery_staff">Delivery Staff</option>
              </select>
              <select
                id="status-filter"
                style="
                  padding: 0.5rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
              <button
                class="btn btn-primary"
                id="add-employee-btn"
                style="white-space: nowrap"
              >
                + Add Employee
              </button>
            </div>
          </div>
          <table id="employee-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Permission</th>
                <th>Shift Start</th>
                <th>Hire Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <p class="footer-note">
          Changes instantly sync with attendance, analytics, and reporting.
        </p>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script>
      // Auto-detect: Production vs Local
      if (
        window.location.hostname !== "localhost" &&
        window.location.hostname !== "127.0.0.1"
      ) {
        window.APP_STATE_ENDPOINT =
          "https://sweetbox-backend.onrender.com/api/state";
      } else {
        window.APP_STATE_ENDPOINT = "http://localhost:8000/api/state";
      }
    </script>
    <script src="js/common.js"></script>
    <script src="js/employees.js"></script>
  </body>
</html>
