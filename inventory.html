<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Control</title>
    <link rel="icon" href="img/sweetbox_icon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="design.css" />
    <link rel="stylesheet" href="responsive.css" />
  </head>

  <body data-page="inventory">
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <img src="img/sweetbox_logo.png" alt="Sweet Box" class="brand-logo" />
        </div>
        <nav class="nav">
          <a href="index.html" data-section="dashboard">Dashboard</a>
          <a href="attendance.html" data-section="attendance">Attendance</a>
          <a
            href="employees.html"
            data-section="employees"
            data-role="admin,manager"
            data-hide-when-denied="true"
            >Users</a
          >
          <a
            href="inventory.html"
            data-section="inventory"
            data-role="admin,inventory_manager,kitchen_staff"
            data-hide-when-denied="true"
            >Inventory</a
          >
          <a href="orders.html" data-section="orders">Orders</a>
          <a
            href="analytics.html"
            data-section="analytics"
            data-role="admin,manager"
            data-hide-when-denied="true"
            >Analytics</a
          >
          <a
            href="report.html"
            data-section="report"
            data-role="admin,inventory_manager"
            data-hide-when-denied="true"
            >Reports</a
          >
        </nav>
        <div class="user-session">
          <div class="user-session-info">
            <div class="user-session-row">
              <strong id="session-name" class="user-session-name">Guest</strong>
              <button
                id="edit-profile-btn"
                type="button"
                class="user-session-edit-btn"
                title="Edit Profile"
              >
                ✏️
              </button>
            </div>
            <small id="session-role" class="user-session-role"
              >Sign in required</small
            >
          </div>
          <button class="btn btn-outline" id="logout-btn" type="button">
            Sign out
          </button>
        </div>
      </aside>

      <main class="main-content">
        <header class="page-header">
          <div>
            <span class="pill">Production control</span>
            <h1>Inventory Management</h1>
          </div>
          <div class="actions">
            <button class="btn btn-secondary" id="refresh-data">Refresh</button>
          </div>
        </header>

        <section class="alert-panel" id="inventory-alert"></section>

        <!-- Inventory Metrics Overview -->
        <section class="card" style="margin-bottom: 2rem">
          <div class="section-heading">
            <h2>Inventory Metrics</h2>
            <span class="pill">Live</span>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1.5rem;
              margin-bottom: 1.5rem;
            "
          >
            <div
              style="
                text-align: center;
                padding: 1rem;
                background: #f9fafb;
                border-radius: 0.5rem;
              "
            >
              <small
                style="
                  color: #666;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.5rem;
                "
                >Total SKUs</small
              >
              <strong
                style="font-size: 1.75rem; color: #333"
                id="metric-total-skus"
                >0</strong
              >
            </div>
            <div
              style="
                text-align: center;
                padding: 1rem;
                background: #fff3cd;
                border-radius: 0.5rem;
              "
            >
              <small
                style="
                  color: #856404;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.5rem;
                "
                >Low Stock Items</small
              >
              <strong
                style="font-size: 1.75rem; color: #856404"
                id="metric-low-stock"
                >0</strong
              >
            </div>
            <div
              style="
                text-align: center;
                padding: 1rem;
                background: #f8d7da;
                border-radius: 0.5rem;
              "
            >
              <small
                style="
                  color: #721c24;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.5rem;
                "
                >Expiring Soon</small
              >
              <strong
                style="font-size: 1.75rem; color: #721c24"
                id="metric-expiring-soon"
                >0</strong
              >
            </div>
            <div
              style="
                text-align: center;
                padding: 1rem;
                background: #d1ecf1;
                border-radius: 0.5rem;
              "
            >
              <small
                style="
                  color: #0c5460;
                  font-size: 0.875rem;
                  display: block;
                  margin-bottom: 0.5rem;
                "
                >Total Inventory Value</small
              >
              <strong
                style="font-size: 1.75rem; color: #0c5460"
                id="metric-total-value"
                >₱0.00</strong
              >
            </div>
          </div>
        </section>

        <!-- Use Ingredients Card -->
        <section class="card" style="margin-bottom: 2rem">
          <div class="section-heading">
            <h2>Use Ingredients</h2>
            <span class="pill">Staff Access</span>
          </div>
          <form id="ingredient-usage-form" style="max-width: 600px">
            <label for="ingredient-select">Select Ingredient</label>
            <select id="ingredient-select" name="ingredientId" required>
              <option value="">Choose ingredient...</option>
            </select>

            <label for="usage-qty">Quantity to Use</label>
            <input
              id="usage-qty"
              name="quantity"
              type="number"
              min="1"
              step="1"
              placeholder="0"
              required
            />

            <label for="usage-reason">Reason (Optional)</label>
            <input
              id="usage-reason"
              name="reason"
              type="text"
              placeholder="e.g., Baking batch #5"
            />

            <button class="btn btn-primary" type="submit">Record Usage</button>
          </form>
        </section>

        <!-- Unified Inventory Table -->
        <section class="table-wrapper" style="margin-top: 2rem">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1rem;
              gap: 1rem;
            "
          >
            <div>
              <h2 style="margin: 0 0 0.25rem 0">All Inventory Items</h2>
              <span class="pill">Unified View</span>
            </div>
            <div
              style="
                display: flex;
                gap: 0.75rem;
                align-items: center;
                flex-wrap: nowrap;
              "
            >
              <!-- Search Bar -->
              <input
                type="search"
                id="unified-search"
                placeholder="Search items..."
                style="
                  padding: 0.5rem 1rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  min-width: 250px;
                "
              />

              <!-- Category Filter -->
              <select
                id="category-filter"
                style="
                  padding: 0.5rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="">All Categories</option>
                <option value="cakes & pastries">Cakes & Pastries</option>
                <option value="ingredients">Ingredients</option>
                <option value="supplies">Supplies</option>
                <option value="beverages">Beverages</option>
              </select>

              <!-- Status Filter -->
              <select
                id="status-filter"
                style="
                  padding: 0.5rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="">All Status</option>
                <option value="in-stock">In Stock</option>
                <option value="low-stock">Low Stock</option>
                <option value="expiring-soon">Expiring Soon</option>
              </select>

              <button
                class="btn btn-primary"
                id="add-item-btn"
                data-role="admin"
                style="white-space: nowrap"
              >
                + Add Item
              </button>
            </div>
          </div>

          <table id="unified-inventory-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Category</th>
                <th>Qty</th>
                <th>Cost</th>
                <th>Purchased</th>
                <th>Use By</th>
                <th>Reorder Point</th>
                <th>Total Used</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="unified-inventory-tbody">
              <tr>
                <td
                  colspan="10"
                  style="text-align: center; padding: 2rem; color: #999"
                >
                  No inventory items found
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <p class="footer-note">
          Use the form above to add new SKUs or update existing counts. Filter
          and search to find specific items.
        </p>
      </main>
    </div>

    <!-- Add Item Modal -->
    <div class="modal-overlay" id="inventory-add-modal">
      <div class="modal-card">
        <div class="modal-card__header">
          <h2>Add Inventory Item</h2>
          <button
            class="btn btn-outline"
            type="button"
            id="inventory-add-close"
          >
            Close
          </button>
        </div>
        <form id="inventory-form" data-role="admin">
          <label for="item-category">Category</label>
          <select id="item-category" name="category" required>
            <option value="">Select category</option>
            <option value="cakes & pastries">Cakes & Pastries</option>
            <option value="ingredients">Ingredients</option>
            <option value="supplies">Supplies</option>
            <option value="beverages">Beverages</option>
          </select>

          <label for="item-name">Item name</label>
          <input
            id="item-name"
            name="name"
            placeholder="Chocolate Mousse Slice"
            required
          />

          <label for="item-qty">Quantity on hand</label>
          <input
            id="item-qty"
            name="quantity"
            type="number"
            min="0"
            step="1"
            required
          />

          <label for="item-cost">Unit cost (₱)</label>
          <input
            id="item-cost"
            name="cost"
            type="number"
            min="0"
            step="0.01"
            required
          />

          <label for="item-date-purchased">Date Purchased</label>
          <input id="item-date-purchased" name="datePurchased" type="date" />

          <label for="item-use-by-date">Use By Date</label>
          <input id="item-use-by-date" name="useByDate" type="date" />

          <label for="item-reorder-point">Reorder Point</label>
          <input
            id="item-reorder-point"
            name="reorderPoint"
            type="number"
            min="0"
            step="1"
            placeholder="10"
          />

          <div class="modal-card__actions">
            <button
              class="btn btn-secondary"
              type="button"
              id="inventory-add-cancel"
            >
              Cancel
            </button>
            <button class="btn btn-primary" type="submit">Add Item</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Item Modal -->
    <div class="modal-overlay" id="inventory-edit-modal">
      <div class="modal-card">
        <div class="modal-card__header">
          <h2>Edit Inventory Item</h2>
          <button
            class="btn btn-outline"
            type="button"
            id="inventory-edit-close"
          >
            Close
          </button>
        </div>
        <form id="inventory-edit-form" data-role="admin">
          <label for="edit-item-category">Category</label>
          <select id="edit-item-category" name="category" required>
            <option value="">Select category</option>
            <option value="cakes & pastries">Cakes & Pastries</option>
            <option value="ingredients">Ingredients</option>
            <option value="supplies">Supplies</option>
            <option value="beverages">Beverages</option>
          </select>

          <label for="edit-item-name">Item name</label>
          <input id="edit-item-name" name="name" required />

          <label for="edit-item-qty">Quantity on hand</label>
          <input
            id="edit-item-qty"
            name="quantity"
            type="number"
            min="0"
            step="1"
            required
          />

          <label for="edit-item-cost">Unit cost (₱)</label>
          <input
            id="edit-item-cost"
            name="cost"
            type="number"
            min="0"
            step="0.01"
            required
          />

          <label for="edit-item-date-purchased">Date Purchased</label>
          <input
            id="edit-item-date-purchased"
            name="datePurchased"
            type="date"
          />

          <label for="edit-item-use-by-date">Use By Date</label>
          <input id="edit-item-use-by-date" name="useByDate" type="date" />

          <label for="edit-item-reorder-point">Reorder Point</label>
          <input
            id="edit-item-reorder-point"
            name="reorderPoint"
            type="number"
            min="0"
            step="1"
          />

          <div class="modal-card__actions">
            <button
              class="btn btn-secondary"
              type="button"
              id="inventory-edit-cancel"
            >
              Cancel
            </button>
            <button class="btn btn-primary" type="submit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script>
      // Auto-detect: Production vs Local
      if (
        window.location.hostname !== "localhost" &&
        window.location.hostname !== "127.0.0.1"
      ) {
        window.APP_STATE_ENDPOINT =
          "https://sweetbox-backend.onrender.com/api/state";
      } else {
        window.APP_STATE_ENDPOINT = "http://localhost:8000/api/state";
      }
    </script>
    <script src="js/common.js"></script>
    <script src="js/inventory.js"></script>
  </body>
</html>
